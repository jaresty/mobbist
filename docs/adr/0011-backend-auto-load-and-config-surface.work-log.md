# ADR-0011 Work Log

## loop-1 | 2026-01-22T18:18:17Z | helper:v20251223.1
- helper_version: helper:v20251223.1
- focus: ADR-0011 (Decision sections 1-6) – establish validation harness path for auto-load, backend surface, heartbeat, and autosave behaviour.
- work_log_updated: `docs/adr/0011-backend-auto-load-and-config-surface.work-log.md` (loop-1)
- active_constraint: ADR-0011 has no runnable validation harness; `node scripts/validate-adr-0011.js` is missing, so auto-load/config-surface behaviours cannot be validated end-to-end.
- expected_value: Impact=High (unblocks verifiable ADR execution), Probability=High (adding harness resolves the gap), Time Sensitivity=Med (needed before implementation); uncertainty: low once harness exists.
- validation_targets:
  - `node scripts/validate-adr-0011.js`
- mitigation_ladder: 1) add ADR-0011 validation harness (Vitest/jsdom or node script); 2) implement auto-load + heartbeat + drawer UI; 3) implement autosave + toast notifications.
- evidence: `docs/adr/evidence/0011/loop-1.md#loop-1-red`
- rollback_plan: `git restore --source=HEAD -- docs/adr/0011-backend-auto-load-and-config-surface.work-log.md docs/adr/evidence/0011/loop-1.md`
- delta_summary: helper:diff-snapshot=clean; new: docs/adr/0011-backend-auto-load-and-config-surface.md, docs/adr/0011-backend-auto-load-and-config-surface.work-log.md, docs/adr/evidence/0011/loop-1.md; recorded red evidence for missing validation harness.
- loops_remaining_forecast: 2–4 loops (build ADR-0011 validation harness, implement auto-load/heartbeat/drawer/autosave, confirm toasts); confidence: Medium.
- residual_constraints:
  - End-to-end backend smoke requires a running backend service outside repo control. Mitigation: keep jsdom/Vitest coverage for ADR-0011 and run manual smoke when backend is available. Severity: Medium. Trigger: backend endpoint changes or smoke test failures. Owner: `docs/adr/0010-backend-contract.md`.
  - Environment requires node_modules to run tests. Mitigation: run `npm install` before next validation loop. Severity: Low. Trigger: validation harness implemented but test runner missing.
- next_work:
  - Behaviour: Add jsdom/Vitest validation harness for ADR-0011 auto-load/heartbeat/drawer/autosave flows; validate via `npm test`; future-shaping action: codify heartbeat/auto-load expectations in tests.
  - Behaviour: Implement auto-load + heartbeat status transitions + compact backend drawer UI; validate via `npm test` with mocked fetch.

## loop-2 | 2026-01-22T18:41:04Z | helper:v20251223.1
- helper_version: helper:v20251223.1
- focus: ADR-0011 (Decision sections 1-4) – add specifying tests and implement auto-load, drawer surface, and heartbeat status.
- work_log_updated: `docs/adr/0011-backend-auto-load-and-config-surface.work-log.md` (loop-2)
- active_constraint: ADR-0011 auto-load and backend drawer behaviour were unimplemented; `npm test` failed on new ADR-0011 expectations until UI/state logic landed.
- expected_value: Impact=High (core UX flow), Probability=High (tests + implementation), Time Sensitivity=High (blocks daily use); uncertainty: low after green.
- validation_targets:
  - `npm test`
- mitigation_ladder: 1) add specifying ADR-0011 tests; 2) implement drawer + auto-load + heartbeat status; 3) implement autosave + toast behaviour.
- evidence:
  - red: `docs/adr/evidence/0011/loop-2.md#loop-2-red`
  - green: `docs/adr/evidence/0011/loop-2.md#loop-2-green`
  - removal: `docs/adr/evidence/0011/loop-2.md#loop-2-removal`
- rollback_plan: `git restore --source=HEAD -- index.html tests/backend-status.test.js docs/adr/evidence/0011/loop-2.md` then re-run `npm test` to observe the red expectation gap.
- delta_summary: helper:diff-snapshot=`index.html | 236 insertions(+), 32 deletions(-); tests/backend-status.test.js | 167 insertions(+), 17 deletions(-)`; added specifying ADR-0011 tests and implemented compact backend drawer, auto-connect/load, and heartbeat status; wip preserved at `docs/adr/evidence/0011/loop-2-wip.patch` for removal check.
- loops_remaining_forecast: 1–2 loops (autosave on unload + toast/error handling + heartbeat UI polish); confidence: Medium.
- residual_constraints:
  - Autosave on unload and toast dismissal logic not implemented yet. Mitigation: add specifying tests for autosave and toast persistence; implement and validate. Severity: Medium. Trigger: ADR-0011 autosave acceptance criteria still unmet.
  - End-to-end backend smoke requires a running backend service outside repo control. Mitigation: keep jsdom/Vitest coverage and run manual smoke when backend is available. Severity: Medium. Trigger: backend endpoint changes or smoke test failures. Owner: `docs/adr/0010-backend-contract.md`.
- next_work:
  - Behaviour: Implement autosave on unload with confirmation fallback + sendBeacon; validate via new ADR-0011 tests in `npm test`.
  - Behaviour: Add toast success/failure behaviour for backend saves; validate via new ADR-0011 tests in `npm test`.

## loop-3 | 2026-01-22T18:50:33Z | helper:v20251223.1
- helper_version: helper:v20251223.1
- focus: ADR-0011 (Decision sections 5-6) – implement autosave on unload and save toast behaviour with specifying tests.
- work_log_updated: `docs/adr/0011-backend-auto-load-and-config-surface.work-log.md` (loop-3)
- active_constraint: Autosave + toast behaviour was unimplemented; new ADR-0011 tests failed until autosave handler, save blocking, and toast metadata were added.
- expected_value: Impact=High (meets unload/save UX), Probability=High (tests + implementation), Time Sensitivity=High (daily workflow); uncertainty: low after green.
- validation_targets:
  - `npm test`
- mitigation_ladder: 1) add specifying autosave/toast tests; 2) implement beforeunload handler + toast metadata; 3) refine autosave retry gating on heartbeat.
- evidence:
  - red: `docs/adr/evidence/0011/loop-3.md#loop-3-red`
  - green: `docs/adr/evidence/0011/loop-3.md#loop-3-green`
  - removal: `docs/adr/evidence/0011/loop-3.md#loop-3-removal`
- rollback_plan: `git restore --source=HEAD -- index.html tests/backend-status.test.js docs/adr/evidence/0011/loop-3.md` then re-run `npm test` to observe the red expectation gap.
- delta_summary: helper:diff-snapshot=`index.html | 85 insertions(+), 4 deletions(-); tests/backend-status.test.js | 60 insertions(+)`; autosave handler + toast metadata added; wip preserved at `docs/adr/evidence/0011/loop-3-wip.patch` for removal check.
- loops_remaining_forecast: 1 loop (tighten autosave retry gating + heartbeat confirm or polish status copy); confidence: Medium.
- residual_constraints:
  - Autosave retry gating relies on heartbeat success only for autosave path; manual saves still attempt even after failure. Mitigation: decide whether to block manual saves or keep manual override; update tests accordingly. Severity: Medium. Trigger: ADR-0011 interpretation changes.
  - sendBeacon payload for existing workspaces uses a best-effort `__method` hint; backend may ignore it. Mitigation: consider keepalive fetch only or backend support for beacon; monitor with manual smoke. Severity: Low. Trigger: backend rejects beacon payloads.
- next_work:
  - Behaviour: Decide manual save behavior when backendSaveBlocked and add specifying tests if needed; validate via `npm test`.
  - Behaviour: Optional polish for heartbeat status copy (checking/unreachable/local) aligned with product language; validate via updated test expectations.

## loop-4 | 2026-01-22T20:29:10Z | helper:v20251223.1
- helper_version: helper:v20251223.1
- focus: ADR-0011 (Decision section 5) – block manual saves while backendSaveBlocked and re-enable saves after heartbeat clears.
- work_log_updated: `docs/adr/0011-backend-auto-load-and-config-surface.work-log.md` (loop-4)
- active_constraint: Manual saves still hit the backend even when backendSaveBlocked is true; `npm test` fails on the new ADR-0011 guardrail that expects no fetch until heartbeat returns connected.
- expected_value: Impact=High (honors ADR-0011 save gating), Probability=High (local guard + heartbeat reset), Time Sensitivity=Med (prevents repeated failures); uncertainty: low after green.
- validation_targets:
  - `npm test`
- mitigation_ladder: 1) add specifying test for manual save blocking + heartbeat recovery; 2) gate saveToBackend for all reasons while blocked; 3) re-enable save buttons when heartbeat returns connected.
- evidence:
  - red: `docs/adr/evidence/0011/loop-4.md#loop-4-red`
  - green: `docs/adr/evidence/0011/loop-4.md#loop-4-green`
  - removal: `docs/adr/evidence/0011/loop-4.md#loop-4-removal`
- rollback_plan: `git restore --source=HEAD -- index.html tests/backend-status.test.js docs/adr/evidence/0011/loop-4.md` then re-run `npm test` to observe the guardrail gap.
- delta_summary: helper:diff-snapshot=`index.html | 11 insertions(+), 1 deletion(-); tests/backend-status.test.js | 28 insertions(+)`; manual saves now respect backendSaveBlocked and heartbeat re-enables save buttons; removal evidence rerun with implementation-only revert and post-removal green verification logged in `docs/adr/evidence/0011/loop-4.md#loop-4-verify`; wip preserved at `docs/adr/evidence/0011/loop-4-wip.patch` for removal check.
- loops_remaining_forecast: 0–1 loops (optional heartbeat copy polish if product language changes); confidence: Medium.
- residual_constraints:
  - End-to-end backend smoke requires a running backend service outside repo control. Mitigation: keep jsdom/Vitest coverage and run manual smoke when backend is available. Severity: Medium. Trigger: backend endpoint changes or smoke test failures. Owner: `docs/adr/0010-backend-contract.md`.
  - sendBeacon payload for existing workspaces uses a best-effort `__method` hint; backend may ignore it. Mitigation: evaluate keepalive fetch-only fallback or align backend support; monitor during manual smoke. Severity: Low. Trigger: backend rejects beacon payloads. Owner: `docs/adr/0010-backend-contract.md`.
  - Optional heartbeat copy tweaks for checking/unreachable/local language. Mitigation: align with product voice when copy guidance lands; update tests accordingly. Severity: Low. Trigger: UX copy review feedback. Owner: `docs/adr/0011-backend-auto-load-and-config-surface.md`.
- next_work:
  - Behaviour: Optional heartbeat status copy polish (checking/unreachable/local) if product language changes; validate via `npm test`.

## loop-5 | 2026-01-22T20:49:10Z | helper:v20251223.1
- helper_version: helper:v20251223.1
- focus: ADR-0011 (Decision section 1) – handle missing backend workspace (404) by prompting to recreate or disconnect, defaulting to recreate with local data.
- work_log_updated: `docs/adr/0011-backend-auto-load-and-config-surface.work-log.md` (loop-5)
- active_constraint: Missing workspace responses (404) force backend offline with no recreate/disconnect prompt; `npm test` fails on the new ADR-0011 expectation for recovery.
- expected_value: Impact=High (unblocks auto-load for lost workspaces), Probability=High (guarded prompt + recreate), Time Sensitivity=Med (avoids user dead-ends); uncertainty: low after green.
- validation_targets:
  - `npm test`
- mitigation_ladder: 1) add specifying test for 404 recreate prompt; 2) implement recreate/disconnect flow in loadFromBackend; 3) confirm status/dirty handling after recreate.
- evidence:
  - red: `docs/adr/evidence/0011/loop-5.md#loop-5-red`
  - green: `docs/adr/evidence/0011/loop-5.md#loop-5-green`
  - removal: `docs/adr/evidence/0011/loop-5.md#loop-5-removal`
- rollback_plan: `git restore --source=HEAD -- index.html tests/backend-status.test.js docs/adr/evidence/0011/loop-5.md` then re-run `npm test` to observe the 404 recovery gap.
- delta_summary: helper:diff-snapshot=`index.html | 29 insertions(+); tests/backend-status.test.js | 32 insertions(+)`; added 404 recreate test and loadFromBackend prompt/recreate handling; wip preserved at `docs/adr/evidence/0011/loop-5-wip.patch` for removal check.
- loops_remaining_forecast: 0–1 loops (optional disconnect-branch test + copy polish); confidence: Medium.
- residual_constraints:
  - Disconnect branch in the 404 prompt is implemented but not yet specified by tests. Mitigation: add a specifying test for cancel-to-local flow and confirm backend URL cleared. Severity: Medium. Trigger: UX review requests explicit coverage.
  - End-to-end backend smoke requires a running backend service outside repo control. Mitigation: keep jsdom/Vitest coverage and run manual smoke when backend is available. Severity: Medium. Trigger: backend endpoint changes or smoke test failures. Owner: `docs/adr/0010-backend-contract.md`.
  - sendBeacon payload for existing workspaces uses a best-effort `__method` hint; backend may ignore it. Mitigation: evaluate keepalive fetch-only fallback or align backend support; monitor during manual smoke. Severity: Low. Trigger: backend rejects beacon payloads. Owner: `docs/adr/0010-backend-contract.md`.
- next_work:
  - Behaviour: Add specifying test for 404 disconnect path (cancel) ensuring local-only mode + cleared backend URL; validate via `npm test`.
  - Behaviour: Optional heartbeat status copy polish (checking/unreachable/local) if product language changes; validate via `npm test`.

## loop-6 | 2026-01-22T20:56:20Z | helper:v20251223.1
- helper_version: helper:v20251223.1
- focus: ADR-0011 (Decision section 3) – stop mutating the URL hash during backend reachability checks and related config writes.
- work_log_updated: `docs/adr/0011-backend-auto-load-and-config-surface.work-log.md` (loop-6)
- active_constraint: Backend reachability updates mutate the URL hash, violating ADR-0011’s no-URL-config rule; `npm test` fails on the new guardrail asserting hash stability.
- expected_value: Impact=Med (prevents URL from encoding backend state), Probability=High (remove hash writes), Time Sensitivity=Low (policy alignment); uncertainty: low after green.
- validation_targets:
  - `npm test`
- mitigation_ladder: 1) add specifying test for hash stability during checks; 2) remove hash writes in reachability + save/connect flows; 3) review hash hydration on init.
- evidence:
  - red: `docs/adr/evidence/0011/loop-6.md#loop-6-red`
  - green: `docs/adr/evidence/0011/loop-6.md#loop-6-green`
  - removal: `docs/adr/evidence/0011/loop-6.md#loop-6-removal`
- rollback_plan: `git restore --source=HEAD -- index.html tests/backend-status.test.js docs/adr/evidence/0011/loop-6.md` then re-run `npm test` to observe the hash mutation regression.
- delta_summary: helper:diff-snapshot=`index.html | 7 deletions(-); tests/backend-status.test.js | 39 insertions(+)`; removed hash writes on backend checks and added hash-stability coverage; wip preserved at `docs/adr/evidence/0011/loop-6-wip.patch` for removal check.
- loops_remaining_forecast: 0–1 loops (decide whether to remove hash hydration on init); confidence: Medium.
- residual_constraints:
  - Hash hydration on init still accepts URL workspace IDs, which may conflict with Decision 3’s “no URL config” intent. Mitigation: decide policy; add specifying test and remove hydration if required. Severity: Medium. Trigger: ADR review clarifies URL handling. Owner: `docs/adr/0011-backend-auto-load-and-config-surface.md`.
  - End-to-end backend smoke requires a running backend service outside repo control. Mitigation: keep jsdom/Vitest coverage and run manual smoke when backend is available. Severity: Medium. Trigger: backend endpoint changes or smoke test failures. Owner: `docs/adr/0010-backend-contract.md`.
  - sendBeacon payload for existing workspaces uses a best-effort `__method` hint; backend may ignore it. Mitigation: evaluate keepalive fetch-only fallback or align backend support; monitor during manual smoke. Severity: Low. Trigger: backend rejects beacon payloads. Owner: `docs/adr/0010-backend-contract.md`.
- next_work:
  - Behaviour: Decide whether init should ignore URL hash hydration; validate via `npm test` with a new URL handling guardrail.
  - Behaviour: Optional heartbeat status copy polish (checking/unreachable/local) if product language changes; validate via `npm test`.

## loop-7 | 2026-01-22T21:00:00Z | helper:v20251223.1
- helper_version: helper:v20251223.1
- focus: ADR-0011 (Decision section 3) – ignore workspace hash hydration on init to keep backend configuration out of the URL.
- work_log_updated: `docs/adr/0011-backend-auto-load-and-config-surface.work-log.md` (loop-7)
- active_constraint: Initial URL hash hydration still injects backend workspace IDs, contradicting Decision 3; `npm test` fails on the new guardrail requiring hash to be ignored on init.
- expected_value: Impact=Med (aligns URL handling with ADR), Probability=High (remove hydration block), Time Sensitivity=Low (policy alignment); uncertainty: low after green.
- validation_targets:
  - `npm test`
- mitigation_ladder: 1) add specifying test for ignoring hash hydration; 2) remove hash hydration block in init; 3) verify no URL mutation remains.
- evidence:
  - red: `docs/adr/evidence/0011/loop-7.md#loop-7-red`
  - green: `docs/adr/evidence/0011/loop-7.md#loop-7-green`
  - removal: `docs/adr/evidence/0011/loop-7.md#loop-7-removal`
- rollback_plan: `git restore --source=HEAD -- index.html tests/backend-status.test.js docs/adr/evidence/0011/loop-7.md` then re-run `npm test` to observe the hash hydration regression.
- delta_summary: helper:diff-snapshot=`index.html | 13 deletions(-), 1 insertion(+); tests/backend-status.test.js | 10 insertions(+)`; removed init hash hydration and added a guardrail test; wip preserved at `docs/adr/evidence/0011/loop-7-wip.patch` for removal check.
- loops_remaining_forecast: 0–1 loops (heartbeat copy polish if desired); confidence: High.
- residual_constraints:
  - End-to-end backend smoke requires a running backend service outside repo control. Mitigation: keep jsdom/Vitest coverage and run manual smoke when backend is available. Severity: Medium. Trigger: backend endpoint changes or smoke test failures. Owner: `docs/adr/0010-backend-contract.md`.
  - sendBeacon payload for existing workspaces uses a best-effort `__method` hint; backend may ignore it. Mitigation: evaluate keepalive fetch-only fallback or align backend support; monitor during manual smoke. Severity: Low. Trigger: backend rejects beacon payloads. Owner: `docs/adr/0010-backend-contract.md`.
- next_work:
  - Behaviour: Optional heartbeat status copy polish (checking/unreachable/local) if product language changes; validate via `npm test`.
